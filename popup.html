<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>鴻海集團差旅平台 填表助手</title>
    <link rel="stylesheet" href="popup.css" />
    <link rel="stylesheet" href="flatpickr.min.css" />
    <link rel="stylesheet" href="flatpickr-dark.css" />
    <link rel="icon" type="image/png" href="icons/icon48.png" />
  </head>
  <body>
    <!-- Header / 頂部標題列 -->
    <div class="cyber-header">
      <h2 class="cyber-glitch" data-text="HH Ters Autofill">HH Ters Autofill</h2>
    </div>

    <!-- Tab 導航 -->
    <div class="cyber-tabs">
      <button class="cyber-tab tab-btn" data-tab="tab-apply" data-active="true">員工因公外出申請單</button>
      <button class="cyber-tab tab-btn" data-tab="tab-expense">員工因公外出報支</button>
      <button class="cyber-tab tab-btn" data-tab="tab-general">員工費用<br />一般費用申請單</button>
    </div>

    <!-- 主內容區 -->
    <div class="cyber-main">
      <!-- TAB 1: 員工因公外出申請單 -->
      <div id="tab-apply" class="tab-content active">
        <!-- 範本控制區 -->
        <div class="cyber-template-section cyber-chamfer-sm">
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            範本管理
          </h3>
          <div class="cyber-field">
            <label for="templateSelect" class="cyber-label">選擇範本 (Template)</label>
            <div class="cyber-template-row">
              <div class="cyber-template-select">
                <select id="templateSelect" class="cyber-select">
                  <option value="">-- 請選擇 --</option>
                </select>
              </div>
              <button id="btn-delete-template" class="cyber-btn cyber-btn--danger" title="刪除此範本">&times;</button>
            </div>
          </div>
          <div class="cyber-template-row">
            <div class="cyber-template-input">
              <input type="text" id="newTemplateName" placeholder="新範本名稱 (例如: 高雄出差)" class="cyber-input cyber-input--no-prefix" />
            </div>
            <button id="btn-save-template" class="cyber-btn cyber-btn--sm">儲存</button>
          </div>
        </div>

        <!-- 重要提醒 -->
        <div class="cyber-alert">
          <strong>⚠️ 重要提醒</strong><br />
          1. 請先在「申請單」頁籤按一次填入。<br />
          2. <strong>切換到「預算＆借支明細」頁籤</strong>，<strong>再按一次「一鍵填入」</strong>，來填寫費用。
        </div>

        <!-- 區段：申請單 -->
        <div>
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            申請單
          </h3>

          <!-- 專案代碼 -->
          <div class="cyber-field">
            <label for="projectCode" class="cyber-label">專案代碼</label>
            <div class="cyber-input-wrap">
              <input type="text" id="projectCode" placeholder="專案代碼" class="cyber-input" />
            </div>
          </div>

          <!-- 外出日期 + 時間 -->
          <div class="cyber-row">
            <div class="cyber-field">
              <label for="date" class="cyber-label">外出日期</label>
              <input type="text" id="date" class="cyber-input cyber-input--no-prefix js-flatpickr-date" placeholder="選擇日期..." />
            </div>
            <div class="cyber-field">
              <label for="time" class="cyber-label">時間</label>
              <input type="text" id="time" class="cyber-input cyber-input--no-prefix js-flatpickr-time" placeholder="選擇時間..." />
            </div>
          </div>

          <!-- 返回日期 + 時間 -->
          <div class="cyber-row">
            <div class="cyber-field">
              <label for="returnDate" class="cyber-label">返回日期</label>
              <input type="text" id="returnDate" class="cyber-input cyber-input--no-prefix js-flatpickr-date" placeholder="選擇日期..." />
            </div>
            <div class="cyber-field">
              <label for="returnTime" class="cyber-label">時間</label>
              <input type="text" id="returnTime" class="cyber-input cyber-input--no-prefix js-flatpickr-time" placeholder="選擇時間..." />
            </div>
          </div>

          <!-- 本日不再返廠 -->
          <div class="cyber-checkbox-wrap">
            <label for="noReturn" class="cyber-checkbox-label">本日不再返廠</label>
            <input type="checkbox" id="noReturn" class="cyber-checkbox" />
          </div>

          <!-- 外出原因 -->
          <div class="cyber-field" style="margin-top: 12px">
            <label for="reason" class="cyber-label">外出原因/目標(O)</label>
            <textarea id="reason" placeholder="詳填工作細項計畫 以OKR方式填寫條列式描述..." class="cyber-textarea"></textarea>
          </div>

          <!-- 預期成效 -->
          <div class="cyber-field">
            <label for="keyResult" class="cyber-label">預期成效 (KR)</label>
            <textarea id="keyResult" placeholder="請輸入預期成效..." class="cyber-textarea"></textarea>
          </div>

          <!-- 交通工具 -->
          <div class="cyber-field">
            <label for="trafficType" class="cyber-label">交通工具</label>
            <select id="trafficType" class="cyber-select">
              <option value="">請選擇</option>
              <option value="A1">A1: 飛機</option>
              <option value="A2">A2: 火車-高鐵</option>
              <option value="A3">A3: 火車-動車</option>
              <option value="A4">A4: 火車-一般</option>
              <option value="A5">A5: 輪船</option>
              <option value="A6">A6: 計程車</option>
              <option value="A7">A7: 公交</option>
              <option value="A8">A8: 地鐵</option>
              <option value="A9">A9: 大巴</option>
              <option value="B1">B1: 自駕</option>
              <option value="B2">B2: 公司派車</option>
              <option value="B3">B3: 步行</option>
            </select>
          </div>

          <!-- 到達地點 -->
          <div class="cyber-field">
            <label for="location" class="cyber-label">到達地點</label>
            <div class="cyber-input-wrap">
              <input type="text" id="location" placeholder="例如：廠商辦公室" class="cyber-input" />
            </div>
          </div>

          <!-- 接洽對象 + 聯系電話 -->
          <div class="cyber-row">
            <div class="cyber-field">
              <label for="contactPerson" class="cyber-label">接洽對象</label>
              <div class="cyber-input-wrap">
                <input type="text" id="contactPerson" class="cyber-input" />
              </div>
            </div>
            <div class="cyber-field">
              <label for="contactPhone" class="cyber-label">聯系電話</label>
              <div class="cyber-input-wrap">
                <input type="text" id="contactPhone" class="cyber-input" />
              </div>
            </div>
          </div>
        </div>

        <!-- 區段：預算&借支明細 -->
        <div style="margin-top: 24px">
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            預算&借支明細
          </h3>

          <!-- 提示 -->
          <div class="cyber-alert cyber-alert--info">
            <strong>💡 提示</strong><br />
            <strong
              >1. 若同一類下有多筆費用，請先點擊網頁上的
              <span class="highlight">(+)</span>
              新增對應數量的欄位，再按一鍵填入。</strong
            ><br />
            2. 請詳述搭乘交通工具之起訖點：<br />
            例如：高鐵左營到南港站<br />
            例如：計程車資-高鐵左營站到高雄市政府
          </div>

          <!-- 預算群組 -->
          <div>
            <!-- 交通費-其他 -->
            <div class="cyber-budget-group cyber-chamfer-sm">
              <div class="cyber-budget-header">
                <span>🚗 交通費-其他</span>
              </div>
              <div id="traffic-container"></div>
              <button class="cyber-btn--add" id="btn-add-traffic"><span class="plus-icon">+</span> 新增一筆</button>
            </div>

            <!-- 其他費用 -->
            <div class="cyber-budget-group cyber-chamfer-sm">
              <div class="cyber-budget-header">
                <span>📦 其他費用</span>
              </div>
              <div id="other-container"></div>
              <button class="cyber-btn--add" id="btn-add-other"><span class="plus-icon">+</span> 新增一筆</button>
            </div>

            <!-- 誤餐費 -->
            <div class="cyber-budget-group cyber-chamfer-sm">
              <div class="cyber-budget-header">
                <span>🍱 誤餐費</span>
              </div>
              <div id="meal-container"></div>
              <button class="cyber-btn--add" id="btn-add-meal"><span class="plus-icon">+</span> 新增一筆</button>
            </div>
          </div>
        </div>

        <!-- 固定底部按鈕 -->
        <div class="cyber-footer">
          <button id="fillBtn" class="cyber-btn--glitch cyber-chamfer-sm">⚡ 一鍵填入</button>
        </div>
      </div>
      <!-- END TAB 1 -->

      <!-- TAB 2: 員工因公外出報支 -->
      <div id="tab-expense" class="tab-content">
        <div class="cyber-placeholder">
          <div class="icon">💸</div>
          <h3>員工因公外出報支</h3>
          <p>此功能尚未開放<br />敬請期待！</p>
        </div>
      </div>

      <!-- TAB 3: 員工費用－一般費用申請 -->
      <div id="tab-general" class="tab-content">
        <!-- 範本控制區 (General) -->
        <div class="cyber-template-section cyber-chamfer-sm">
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            範本管理
          </h3>
          <div class="cyber-field">
            <label for="templateSelectGeneral" class="cyber-label">選擇範本 (Template)</label>
            <div class="cyber-template-row">
              <div class="cyber-template-select">
                <select id="templateSelectGeneral" class="cyber-select">
                  <option value="">-- 請選擇 --</option>
                </select>
              </div>
              <button id="btn-delete-template-general" class="cyber-btn cyber-btn--danger" title="刪除此範本">&times;</button>
            </div>
          </div>
          <div class="cyber-template-row">
            <div class="cyber-template-input">
              <input type="text" id="newTemplateNameGeneral" placeholder="新範本名稱 (例如: 一般費用代墊)" class="cyber-input cyber-input--no-prefix" />
            </div>
            <button id="btn-save-template-general" class="cyber-btn cyber-btn--sm">儲存</button>
          </div>
        </div>

        <!-- 區段：基本資料 -->
        <div>
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            基本資料
          </h3>
          <div class="cyber-field">
            <label for="txtProjCode" class="cyber-label">專案代碼</label>
            <div class="cyber-input-wrap">
              <input type="text" id="txtProjCode" placeholder="專案代碼" class="cyber-input" />
            </div>
          </div>
          <div class="cyber-field">
            <label for="txtRemark" class="cyber-label">費用項目說明</label>
            <textarea id="txtRemark" placeholder="請詳細填寫: 例如什麼專案需求" class="cyber-textarea"></textarea>
          </div>
        </div>

        <!-- 區段：費用明細 -->
        <div style="margin-top: 24px">
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            費用明細
          </h3>

          <div id="general-rows-container"></div>

          <button class="cyber-btn--add" id="btn-add-general-row"><span class="plus-icon">+</span> 新增一筆</button>
        </div>

        <!-- 區段：附檔類別 -->
        <div style="margin-top: 24px">
          <h3 class="cyber-section-title">
            <span class="indicator"></span>
            附檔類別
          </h3>
          <div class="cyber-field">
            <label for="attachmentType" class="cyber-label">附檔類別</label>
            <select id="attachmentType" class="cyber-select">
              <option value="GENERICFEE" selected>一般費用</option>
              <option value="REIMBURSEMENT">銷差</option>
              <option value="TRIP">出差/返鄉</option>
              <option value="JJSQ">交際申請</option>
              <option value="JJBX">交際報銷</option>
              <option value="BOARDING">乘機說明</option>
              <option value="BATCHAPPROVEEXCEL">批量簽核清單</option>
              <option value="BATCHAPPROVECONTACT">批量簽核聯絡單</option>
              <option value="STATEMENT">對賬單</option>
            </select>
          </div>
          <!-- 警語 -->
          <div class="cyber-alert cyber-alert--warning" style="margin-top: 12px">
            <strong>⚠️ 注意事項</strong><br />
            1. 請留意上傳格式。<br />
            2. 高鐵票檔案<strong>不要設置密碼</strong>。
          </div>
        </div>

        <!-- 底部按鈕 -->
        <div class="cyber-footer">
          <button id="fillGeneralBtn" class="cyber-btn--glitch cyber-chamfer-sm">⚡ 一鍵填入</button>
        </div>
      </div>
    </div>

    <!-- 狀態通知 (Toast) -->
    <div id="status" class="cyber-status"></div>

    <!-- 問題回報浮動按鈕 -->
    <button id="reportFab" class="cyber-fab" title="問題回報">📩</button>

    <!-- 問題回報 Overlay -->
    <div id="reportOverlay" class="report-overlay">
      <div class="report-panel cyber-chamfer">
        <div class="report-header">
          <h3 class="cyber-section-title" style="margin-bottom: 0; border-bottom: none; padding-bottom: 0">
            <span class="indicator"></span>
            問題回報
          </h3>
          <button id="reportClose" class="cyber-btn-remove" title="關閉" style="font-size: 20px">×</button>
        </div>

        <!-- 說明 -->
        <p class="report-desc">
          若您遇到以下情況，歡迎回報讓我們改進：<br />
          ⚙️ 網站改版導致欄位異動<br />
          🐛 擴充功能出現 Bug<br />
          💡 其他建議或需求
        </p>

        <!-- 主旨 -->
        <div class="cyber-field">
          <label for="reportSubject" class="cyber-label">主旨</label>
          <div class="cyber-input-wrap">
            <input type="text" id="reportSubject" placeholder="例如：某欄位無法填入" class="cyber-input" />
          </div>
        </div>

        <!-- 問題描述 -->
        <div class="cyber-field">
          <label for="reportBody" class="cyber-label">問題描述</label>
          <textarea id="reportBody" placeholder="請詳細描述您遇到的問題或建議..." class="cyber-textarea" style="min-height: 120px"></textarea>
        </div>

        <!-- 送出按鈕 -->
        <button id="reportSubmit" class="cyber-btn--glitch cyber-chamfer-sm" style="margin-top: 8px">📨 送出回報</button>
      </div>
    </div>

    <!-- 預算列模板 -->
    <template id="budget-row-template">
      <div class="budget-row-item cyber-budget-row">
        <div class="cyber-budget-row-header">
          <span class="row-label cyber-row-label">#1</span>
          <button class="btn-remove-row cyber-btn-remove" title="移除此項目">&times;</button>
        </div>
        <div style="margin-bottom: 6px">
          <input type="text" class="input-desc cyber-input--mini" placeholder="費用說明" />
        </div>
        <div class="cyber-budget-inputs-row">
          <div class="amount-col">
            <input type="number" class="input-amount cyber-input--mini" placeholder="金額" />
          </div>
          <div class="currency-col">
            <select class="input-currency cyber-select--mini">
              <option value="NTD">NTD</option>
              <option value="RMB">RMB</option>
              <option value="USD">USD</option>
            </select>
          </div>
        </div>
      </div>
    </template>

    <!-- 一般費用明細列模板 -->
    <template id="general-row-template">
      <div class="general-row-item cyber-budget-row">
        <div class="cyber-budget-row-header">
          <span class="row-label cyber-row-label">#1</span>
          <button class="btn-remove-row cyber-btn-remove" title="移除此項目">&times;</button>
        </div>

        <!-- 日期 -->
        <div class="cyber-row">
          <div class="cyber-field">
            <input type="text" class="input-start-date cyber-input--mini js-flatpickr-date" placeholder="開始日期" />
          </div>
          <div class="cyber-field">
            <input type="text" class="input-end-date cyber-input--mini js-flatpickr-date" placeholder="結束日期" />
          </div>
        </div>

        <!-- 費用類型 (兩層) -->
        <div class="cyber-row" style="margin-top: 8px">
          <div class="cyber-field">
            <select class="input-fee-type-1 cyber-select--mini">
              <option value="">-- 類型 --</option>
              <option value="差旅費">差旅費</option>
              <option value="L01">辦公費用</option>
              <option value="L02">交通費</option>
              <option value="L03">通訊費</option>
              <option value="L04">保險費</option>
              <option value="L05">人員招募費</option>
              <option value="L06">職工培訓費</option>
              <option value="L07">宿舍費用</option>
              <option value="L08">福利費</option>
              <option value="L09">加工費用</option>
              <option value="L10">模治具費用</option>
              <option value="L11">包裝費用</option>
              <option value="L12">消耗用品</option>
              <option value="L13">間接材料</option>
              <option value="L14">檢測費用</option>
              <option value="L15">維修保養費</option>
              <option value="L16">動力費</option>
              <option value="L17">租金支出</option>
              <option value="L18">物流倉儲費用</option>
              <option value="L19">業務推廣費</option>
              <option value="L20">罰款支出</option>
              <option value="L21">軟體費用</option>
              <option value="L22">硬體費用</option>
              <option value="L23">稅費</option>
              <option value="L24">賠償損失</option>
              <option value="L25">會費與政府規費</option>
              <option value="L26">環境保護費</option>
              <option value="L27">專業服務費</option>
              <option value="L28">勞動保護費</option>
              <option value="L29">進口通關費用</option>
              <option value="L30">出口通關費用</option>
              <option value="L31">財務費用</option>
              <option value="L32">設備稅金</option>
              <option value="L33">其他費用</option>
              <option value="L34">雜項購置</option>
              <option value="L35">安全生產費</option>
              <option value="L36">工會費用(工會法人專用)</option>
            </select>
          </div>
          <div class="cyber-field">
            <select class="input-fee-type-2 cyber-select--mini" disabled>
              <option value="">-- 子類型 --</option>
            </select>
          </div>
        </div>

        <!-- 原幣別 + 金額 -->
        <div class="cyber-budget-inputs-row" style="margin-top: 8px">
          <div class="currency-col">
            <select class="input-currency cyber-select--mini">
              <option value="NTD">NTD</option>
              <option value="RMB">RMB</option>
              <option value="USD">USD</option>
              <option value="HKD">HKD</option>
            </select>
          </div>
          <div class="amount-col">
            <input type="number" class="input-amount cyber-input--mini" placeholder="金額" />
          </div>
        </div>

        <!-- 備註 -->
        <div style="margin-top: 8px">
          <input type="text" class="input-remark cyber-input--mini" placeholder="備註 (KR)：請註明細項，例如:郵資快遞(寄什麼到哪)" />
        </div>
      </div>
    </template>

    <script src="flatpickr.min.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
